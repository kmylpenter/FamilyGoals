<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#faf8f5">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>FamilyGoals</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="css/main.css">
</head>
<body>

  <!-- Pull-to-Refresh Indicator -->
  <div id="pull-indicator" class="pull-indicator">
    <span class="pull-spinner">ğŸ”„</span>
  </div>

  <!-- Toast Notifications Container -->
  <div id="toast-container" class="toast-container"></div>

  <!-- ========== PIN Screen ========== -->
  <div id="pin-screen" class="screen pin-screen active">
    <div class="pin-logo">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
    <h1 class="pin-title">WprowadÅº PIN</h1>
    <div class="pin-container" id="pin-container">
      <div class="pin-dots">
        <div class="pin-dot"></div>
        <div class="pin-dot"></div>
        <div class="pin-dot"></div>
        <div class="pin-dot"></div>
      </div>
    </div>
    <div class="pin-keypad" role="group" aria-label="Klawiatura PIN">
      <button type="button" class="pin-key" onclick="pinKey('1')" aria-label="1">1</button>
      <button type="button" class="pin-key" onclick="pinKey('2')" aria-label="2">2</button>
      <button type="button" class="pin-key" onclick="pinKey('3')" aria-label="3">3</button>
      <button type="button" class="pin-key" onclick="pinKey('4')" aria-label="4">4</button>
      <button type="button" class="pin-key" onclick="pinKey('5')" aria-label="5">5</button>
      <button type="button" class="pin-key" onclick="pinKey('6')" aria-label="6">6</button>
      <button type="button" class="pin-key" onclick="pinKey('7')" aria-label="7">7</button>
      <button type="button" class="pin-key" onclick="pinKey('8')" aria-label="8">8</button>
      <button type="button" class="pin-key" onclick="pinKey('9')" aria-label="9">9</button>
      <div class="pin-key empty" aria-hidden="true"></div>
      <button type="button" class="pin-key" onclick="pinKey('0')" aria-label="0">0</button>
      <button type="button" class="pin-key delete" onclick="pinKey('del')" aria-label="UsuÅ„">âŒ«</button>
    </div>
  </div>

  <!-- ========== Dashboard ========== -->
  <div id="screen-dashboard" class="screen dashboard">
    <header class="header" aria-label="NagÅ‚Ã³wek strony gÅ‚Ã³wnej">
      <div class="brand">ğŸ  FamilyGoals</div>
      <span class="month-badge" id="month-badge">GrudzieÅ„ 2025</span>
    </header>

    <!-- Alerts Section -->
    <div id="alerts-container" class="alerts-container"></div>

    <!-- Daily Tip Section -->
    <div id="daily-tip" class="daily-tip-card" style="display: none;"></div>

    <!-- Savings Hero -->
    <div class="income-hero">
      <div class="income-hero-title">ğŸ¯ Do odÅ‚oÅ¼enia w tym miesiÄ…cu</div>
      <div class="income-row">
        <div class="income-actual" id="savings-required">3 855 zÅ‚</div>
        <div class="income-required">
          <div class="income-required-label">odÅ‚oÅ¼one</div>
          <div class="income-required-value" id="savings-done">1 200 zÅ‚</div>
        </div>
      </div>
      <div class="income-bar">
        <div class="income-bar-fill" id="savings-bar" style="width: 31%"></div>
      </div>
      <div class="income-bar-text">
        <span>ZostaÅ‚o: 2 655 zÅ‚</span>
        <span>31%</span>
      </div>
    </div>

    <!-- Goals breakdown -->
    <h2 class="section-title">ğŸ“‹ SkÄ…d ta kwota?</h2>
    <div id="goals-list">
      <div class="goal-card" onclick="showScreen('screen-goals')" tabindex="0" role="button" aria-label="Cel: Studia Kasi">
        <div class="goal-header">
          <span class="goal-name">ğŸ“ Studia Kasi</span>
          <span class="goal-amount monthly">1 500 zÅ‚/m</span>
        </div>
        <div class="goal-detail">
          <span class="goal-type">Jednorazowy</span>
          <span>32 000 / 50 000 zÅ‚</span>
        </div>
      </div>
      <div class="goal-card" onclick="showScreen('screen-goals')" tabindex="0" role="button" aria-label="Cel: Remont kuchni">
        <div class="goal-header">
          <span class="goal-name">ğŸ  Remont kuchni</span>
          <span class="goal-amount monthly">1 667 zÅ‚/m</span>
        </div>
        <div class="goal-detail">
          <span class="goal-type">Jednorazowy</span>
          <span>5 000 / 25 000 zÅ‚</span>
        </div>
      </div>
      <div class="goal-card future" onclick="showScreen('screen-goals')" tabindex="0" role="button" aria-label="Cel: Rata kredytu">
        <div class="goal-header">
          <span class="goal-name">ğŸ¦ Rata kredytu</span>
          <span class="goal-amount monthly warning">+5 000 zÅ‚/m</span>
        </div>
        <div class="goal-detail">
          <span class="goal-type">StaÅ‚y od 2027</span>
          <span>âš ï¸ PodnieÅ› zarobki!</span>
        </div>
      </div>
    </div>

    <!-- Income Status -->
    <h2 class="section-title">ğŸ’° Wasze przychody</h2>
    <div class="income-status-card" onclick="showScreen('screen-income')" tabindex="0" role="button" aria-label="PrzejdÅº do przychodÃ³w">
      <div class="income-status-row">
        <span>Wymagane</span>
        <span class="income-value">12 000 zÅ‚</span>
      </div>
      <div class="income-status-row">
        <span>Przychody</span>
        <span class="income-value positive">8 500 zÅ‚</span>
      </div>
      <div class="income-status-row total">
        <span>Brakuje</span>
        <span class="income-value negative">-3 500 zÅ‚</span>
      </div>
    </div>

    <!-- Timeline -->
    <h2 class="section-title">ğŸ“ˆ Historia zarobkÃ³w</h2>
    <div class="timeline-card" id="timeline-chart-container">
      <div class="timeline-chart" id="timeline-chart">
        <!-- Dynamic timeline will be rendered here -->
      </div>
    </div>

    <!-- Expense Pie Chart -->
    <h2 class="section-title">ğŸ“Š Wydatki tego miesiÄ…ca</h2>
    <div class="chart-container" id="expense-chart-container">
      <div class="pie-chart" id="pie-chart">
        <svg viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="34" stroke="#e8e1f5" stroke-dasharray="213.6 213.6" stroke-dashoffset="0"></circle>
        </svg>
        <div class="pie-center">
          <div class="pie-center-value" id="total-expenses">0 zÅ‚</div>
          <div class="pie-center-label">wydatki</div>
        </div>
      </div>
      <div class="chart-legend" id="chart-legend">
        <!-- Dynamic legend will be rendered here -->
      </div>
    </div>

    <!-- Quick Stats -->
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-icon">ğŸ‘©</div>
        <div class="stat-value positive">6 000 zÅ‚</div>
        <div class="stat-label">Å»ona</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ‘¨</div>
        <div class="stat-value positive">2 500 zÅ‚</div>
        <div class="stat-label">MÄ…Å¼</div>
      </div>
    </div>

    <button type="button" class="fab" onclick="openModal('modal-add')" aria-label="Dodaj nowy element">+</button>
  </div>

  <!-- ========== Income Screen ========== -->
  <div id="screen-income" class="screen list-screen">
    <header class="header" aria-label="NagÅ‚Ã³wek przychodÃ³w">
      <button type="button" class="back-btn" onclick="showScreen('screen-dashboard')" aria-label="WrÃ³Ä‡">â†</button>
      <h1 class="header-title">ğŸ’° Przychody</h1>
      <button type="button" class="add-btn" onclick="openModal('modal-income')" aria-label="Dodaj przychÃ³d">+</button>
    </header>

    <div class="month-selector" role="group" aria-label="WybÃ³r miesiÄ…ca">
      <button type="button" class="month-arrow" aria-label="Poprzedni miesiÄ…c">â†</button>
      <span>GrudzieÅ„ 2025</span>
      <button type="button" class="month-arrow" aria-label="NastÄ™pny miesiÄ…c">â†’</button>
    </div>

    <div class="summary-card mint">
      <div class="summary-row">
        <span>Otrzymane</span>
        <span class="summary-value">8 500 zÅ‚</span>
      </div>
      <div class="summary-row">
        <span>Oczekiwane</span>
        <span class="summary-value muted">12 000 zÅ‚</span>
      </div>
      <div class="income-bar"><div class="income-bar-fill" style="width: 71%"></div></div>
    </div>

    <h2 class="section-title">Å¹rÃ³dÅ‚a przychodÃ³w</h2>
    <div class="list">
      <div class="list-item" onclick="openModal('modal-income')" tabindex="0" role="button" aria-label="Edytuj: Pensja Å»ona">
        <div class="list-icon">ğŸ’¼</div>
        <div class="list-content">
          <div class="list-title">Pensja (Å»ona)</div>
          <div class="list-subtitle">WpÅ‚ynÄ™Å‚o 10 gru</div>
        </div>
        <div class="list-amount positive">6 000 zÅ‚</div>
        <div class="list-status done">âœ“</div>
      </div>
      <div class="list-item" onclick="openModal('modal-income')" tabindex="0" role="button" aria-label="Edytuj: Pensja MÄ…Å¼">
        <div class="list-icon">ğŸ’¼</div>
        <div class="list-content">
          <div class="list-title">Pensja (MÄ…Å¼)</div>
          <div class="list-subtitle">Oczekiwane 25 gru</div>
        </div>
        <div class="list-amount">2 500 zÅ‚</div>
        <div class="list-status pending">â³</div>
      </div>
      <div class="list-item" onclick="openModal('modal-income')" tabindex="0" role="button" aria-label="Edytuj: Freelance">
        <div class="list-icon">ğŸ’»</div>
        <div class="list-content">
          <div class="list-title">Freelance</div>
          <div class="list-subtitle">Brak wpÅ‚at</div>
        </div>
        <div class="list-amount muted">0 / 1 000 zÅ‚</div>
        <div class="list-status pending">âŒ</div>
      </div>
    </div>

    <button type="button" class="fab" onclick="openModal('modal-income')" aria-label="Dodaj przychÃ³d">+</button>
  </div>

  <!-- ========== Goals Screen ========== -->
  <div id="screen-goals" class="screen list-screen">
    <header class="header" aria-label="NagÅ‚Ã³wek celÃ³w">
      <button type="button" class="back-btn" onclick="showScreen('screen-dashboard')" aria-label="WrÃ³Ä‡">â†</button>
      <h1 class="header-title">ğŸ¯ Cele</h1>
      <button type="button" class="add-btn" onclick="openModal('modal-goal')" aria-label="Dodaj cel">+</button>
    </header>

    <div class="summary-card peach">
      <div class="summary-row">
        <span>MiesiÄ™czne oszczÄ™dnoÅ›ci</span>
        <span class="summary-value">3 855 zÅ‚</span>
      </div>
      <div class="summary-row">
        <span>Aktywne cele</span>
        <span class="summary-value muted">4</span>
      </div>
    </div>

    <h2 class="section-title">Jednorazowe</h2>
    <div class="list">
      <div class="goal-item" onclick="openModal('modal-goal')" tabindex="0" role="button" aria-label="Edytuj cel: Studia Kasi">
        <div class="goal-item-header">
          <span class="goal-item-icon">ğŸ“</span>
          <div class="goal-item-info">
            <div class="goal-item-name">Studia Kasi</div>
            <div class="goal-item-date">WrzesieÅ„ 2026</div>
          </div>
          <div class="goal-item-monthly">1 500 zÅ‚/m</div>
        </div>
        <div class="goal-bar"><div class="goal-bar-fill mint" style="width: 64%"></div></div>
        <div class="goal-item-footer">
          <span>32 000 / 50 000 zÅ‚</span>
          <span>64%</span>
        </div>
      </div>
      <div class="goal-item" onclick="openModal('modal-goal')" tabindex="0" role="button" aria-label="Edytuj cel: Remont kuchni">
        <div class="goal-item-header">
          <span class="goal-item-icon">ğŸ </span>
          <div class="goal-item-info">
            <div class="goal-item-name">Remont kuchni</div>
            <div class="goal-item-date">GrudzieÅ„ 2026</div>
          </div>
          <div class="goal-item-monthly">1 667 zÅ‚/m</div>
        </div>
        <div class="goal-bar"><div class="goal-bar-fill peach" style="width: 20%"></div></div>
        <div class="goal-item-footer">
          <span>5 000 / 25 000 zÅ‚</span>
          <span>20%</span>
        </div>
      </div>
      <div class="goal-item" onclick="openModal('modal-goal')" tabindex="0" role="button" aria-label="Edytuj cel: Wakacje">
        <div class="goal-item-header">
          <span class="goal-item-icon">ğŸ–ï¸</span>
          <div class="goal-item-info">
            <div class="goal-item-name">Wakacje</div>
            <div class="goal-item-date">SierpieÅ„ 2025</div>
          </div>
          <div class="goal-item-monthly">688 zÅ‚/m</div>
        </div>
        <div class="goal-bar"><div class="goal-bar-fill lavender" style="width: 45%"></div></div>
        <div class="goal-item-footer">
          <span>4 500 / 10 000 zÅ‚</span>
          <span>45%</span>
        </div>
      </div>
    </div>

    <h2 class="section-title">PrzyszÅ‚e zobowiÄ…zania</h2>
    <div class="list">
      <div class="goal-item future" onclick="openModal('modal-goal')" tabindex="0" role="button" aria-label="Edytuj cel: Rata kredytu">
        <div class="goal-item-header">
          <span class="goal-item-icon">ğŸ¦</span>
          <div class="goal-item-info">
            <div class="goal-item-name">Rata kredytu</div>
            <div class="goal-item-date">Od stycznia 2027</div>
          </div>
          <div class="goal-item-monthly warning">+5 000 zÅ‚/m</div>
        </div>
        <div class="goal-item-warning">
          âš ï¸ PodnieÅ›cie zarobki o 5 000 zÅ‚ do tego czasu!
        </div>
      </div>
    </div>

    <button type="button" class="fab" onclick="openModal('modal-goal')" aria-label="Dodaj cel">+</button>
  </div>

  <!-- ========== Achievements Screen ========== -->
  <div id="screen-achievements" class="screen list-screen">
    <header class="header" aria-label="NagÅ‚Ã³wek osiÄ…gniÄ™Ä‡">
      <button type="button" class="back-btn" onclick="showScreen('screen-dashboard')" aria-label="WrÃ³Ä‡">â†</button>
      <h1 class="header-title">ğŸ† OsiÄ…gniÄ™cia</h1>
    </header>

    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-icon">ğŸ‘©</div>
        <div class="stat-value">1 250 pkt</div>
        <div class="stat-label">Å»ona â€¢ 23/105</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ‘¨</div>
        <div class="stat-value">980 pkt</div>
        <div class="stat-label">MÄ…Å¼ â€¢ 19/105</div>
      </div>
    </div>

    <h2 class="section-title">ğŸ”¥ Streak</h2>
    <div class="streak-card">
      <div class="streak-info">
        <span class="streak-days">14 dni</span>
        <span class="streak-label">z rzÄ™du</span>
      </div>
      <div class="streak-bonus">MnoÅ¼nik: 2.0x</div>
      <div class="income-bar"><div class="income-bar-fill" style="width: 47%"></div></div>
      <div class="streak-footer">Do 30 dni: jeszcze 16</div>
    </div>

    <h2 class="section-title">Ostatnio odblokowane</h2>
    <div class="list">
      <div class="achievement-item unlocked">
        <div class="achievement-icon">ğŸ’°</div>
        <div class="achievement-content">
          <div class="achievement-name">TysiÄ…cznik</div>
          <div class="achievement-desc">ZaoszczÄ™dÅº 1000 zÅ‚</div>
        </div>
        <div class="achievement-points">+50 pkt</div>
      </div>
      <div class="achievement-item unlocked">
        <div class="achievement-icon">ğŸ”¥</div>
        <div class="achievement-content">
          <div class="achievement-name">TydzieÅ„ w akcji</div>
          <div class="achievement-desc">7 dni streak</div>
        </div>
        <div class="achievement-points">+35 pkt</div>
      </div>
    </div>

    <h2 class="section-title">Kategorie</h2>
    <div class="list">
      <div class="category-progress">
        <span>ğŸŒŸ Pierwsze kroki</span>
        <div class="income-bar small"><div class="income-bar-fill" style="width: 80%"></div></div>
        <span>8/10</span>
      </div>
      <div class="category-progress">
        <span>ğŸ’° OszczÄ™dnoÅ›ci</span>
        <div class="income-bar small"><div class="income-bar-fill" style="width: 25%"></div></div>
        <span>5/20</span>
      </div>
      <div class="category-progress">
        <span>ğŸ¯ Cele</span>
        <div class="income-bar small"><div class="income-bar-fill" style="width: 27%"></div></div>
        <span>4/15</span>
      </div>
      <div class="category-progress">
        <span>ğŸ’‘ WspÃ³Å‚praca</span>
        <div class="income-bar small"><div class="income-bar-fill" style="width: 13%"></div></div>
        <span>2/15</span>
      </div>
    </div>
  </div>

  <!-- ========== Settings Screen ========== -->
  <div id="screen-settings" class="screen list-screen">
    <header class="header" aria-label="NagÅ‚Ã³wek ustawieÅ„">
      <button type="button" class="back-btn" onclick="showScreen('screen-dashboard')" aria-label="WrÃ³Ä‡">â†</button>
      <h1 class="header-title">âš™ï¸ Ustawienia</h1>
    </header>

    <div class="list">
      <div class="list-item" tabindex="0" role="button" aria-label="ZmieÅ„ PIN">
        <div class="list-icon">ğŸ”</div>
        <div class="list-content">
          <div class="list-title">ZmieÅ„ PIN</div>
        </div>
        <div class="list-arrow">â†’</div>
      </div>
      <div class="list-item" tabindex="0" role="button" aria-label="Kategorie">
        <div class="list-icon">ğŸ“</div>
        <div class="list-content">
          <div class="list-title">Kategorie</div>
        </div>
        <div class="list-arrow">â†’</div>
      </div>
      <div class="list-item" tabindex="0" role="button" aria-label="Eksport danych">
        <div class="list-icon">ğŸ’¾</div>
        <div class="list-content">
          <div class="list-title">Eksport danych</div>
        </div>
        <div class="list-arrow">â†’</div>
      </div>
      <div class="list-item" tabindex="0" role="button" aria-label="Import danych">
        <div class="list-icon">ğŸ“¥</div>
        <div class="list-content">
          <div class="list-title">Import danych</div>
        </div>
        <div class="list-arrow">â†’</div>
      </div>
      <div class="list-item danger" tabindex="0" role="button" aria-label="WyczyÅ›Ä‡ dane">
        <div class="list-icon">ğŸ—‘ï¸</div>
        <div class="list-content">
          <div class="list-title">WyczyÅ›Ä‡ dane</div>
        </div>
        <div class="list-arrow">â†’</div>
      </div>
    </div>

    <div class="app-info">
      <div>FamilyGoals v2.1</div>
      <div class="muted" id="last-sync-time">Ostatnia aktualizacja: teraz</div>
    </div>
  </div>

  <!-- ========== MODALS ========== -->

  <!-- Add Menu Modal -->
  <div id="modal-add" class="modal" role="dialog" aria-label="Menu dodawania" onclick="closeModal(event)">
    <div class="modal-menu" role="menu">
      <button type="button" class="modal-menu-item" onclick="openModal('modal-income')" role="menuitem">
        <span class="modal-menu-icon" aria-hidden="true">ğŸ’µ</span>
        <span>Dodaj przychÃ³d</span>
      </button>
      <button type="button" class="modal-menu-item" onclick="openModal('modal-expense')" role="menuitem">
        <span class="modal-menu-icon" aria-hidden="true">ğŸ’¸</span>
        <span>Dodaj wydatek</span>
      </button>
      <button type="button" class="modal-menu-item" onclick="openModal('modal-goal')" role="menuitem">
        <span class="modal-menu-icon" aria-hidden="true">ğŸ¯</span>
        <span>Dodaj cel</span>
      </button>
    </div>
  </div>

  <!-- Income Modal -->
  <div id="modal-income" class="modal" role="dialog" aria-label="Formularz przychodu" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2>ğŸ’µ Dodaj przychÃ³d</h2>
        <button type="button" class="modal-close" onclick="closeAllModals()" aria-label="Zamknij">âœ•</button>
      </div>
      <form class="form">
        <div class="form-group">
          <label>Kwota (zÅ‚)</label>
          <input type="number" placeholder="0" class="input-large">
        </div>
        <div class="form-group">
          <label>Å¹rÃ³dÅ‚o</label>
          <div class="chips">
            <button type="button" class="chip active">ğŸ’¼ Pensja</button>
            <button type="button" class="chip">ğŸ’» Freelance</button>
            <button type="button" class="chip">ğŸ Bonus</button>
            <button type="button" class="chip">ğŸ“ˆ Inne</button>
          </div>
        </div>
        <div class="form-group">
          <label>Kto?</label>
          <div class="chips">
            <button type="button" class="chip active">ğŸ‘© Å»ona</button>
            <button type="button" class="chip">ğŸ‘¨ MÄ…Å¼</button>
          </div>
        </div>
        <div class="form-group">
          <label>Data</label>
          <input type="date" value="2025-12-28">
        </div>
        <div class="form-group">
          <label>Notatka (opcjonalnie)</label>
          <input type="text" placeholder="np. Premia Å›wiÄ…teczna">
        </div>
        <button type="submit" class="btn-primary sticky">ğŸ’¾ Zapisz</button>
      </form>
    </div>
  </div>

  <!-- Expense Modal -->
  <div id="modal-expense" class="modal" role="dialog" aria-label="Formularz wydatku" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2>ğŸ’¸ Dodaj wydatek</h2>
        <button type="button" class="modal-close" onclick="closeAllModals()" aria-label="Zamknij">âœ•</button>
      </div>
      <form class="form">
        <div class="form-group">
          <label>Kwota (zÅ‚)</label>
          <input type="number" placeholder="0" class="input-large">
        </div>
        <div class="form-group">
          <label>Kategoria</label>
          <div class="chips">
            <button type="button" class="chip" data-category-id="housing">ğŸ  Mieszkanie</button>
            <button type="button" class="chip active" data-category-id="food">ğŸ½ï¸ Jedzenie</button>
            <button type="button" class="chip" data-category-id="transport">ğŸš— Transport</button>
            <button type="button" class="chip" data-category-id="children">ğŸ‘¶ Dzieci</button>
            <button type="button" class="chip" data-category-id="health">â¤ï¸ Zdrowie</button>
            <button type="button" class="chip" data-category-id="entertainment">ğŸ¬ Rozrywka</button>
            <button type="button" class="chip" data-category-id="education">ğŸ“š Edukacja</button>
            <button type="button" class="chip" data-category-id="clothing">ğŸ‘• Ubrania</button>
            <button type="button" class="chip" data-category-id="hygiene">ğŸ§´ Higiena</button>
            <button type="button" class="chip" data-category-id="gifts">ğŸ Prezenty</button>
            <button type="button" class="chip" data-category-id="savings">ğŸ’° OszczÄ™dnoÅ›ci</button>
            <button type="button" class="chip" data-category-id="other">ğŸ“¦ Inne</button>
          </div>
        </div>
        <div class="form-group">
          <label>Opis</label>
          <input type="text" placeholder="np. Zakupy Biedronka">
        </div>
        <div class="form-group">
          <label>Data</label>
          <input type="date" value="2025-12-28">
        </div>
        <button type="submit" class="btn-primary sticky">ğŸ’¾ Zapisz</button>
      </form>
    </div>
  </div>

  <!-- Goal Modal -->
  <div id="modal-goal" class="modal" role="dialog" aria-label="Formularz celu" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2>ğŸ¯ Nowy cel</h2>
        <button type="button" class="modal-close" onclick="closeAllModals()" aria-label="Zamknij">âœ•</button>
      </div>
      <form class="form">
        <div class="form-group">
          <label>Nazwa celu</label>
          <input type="text" placeholder="np. Wakacje w Grecji">
        </div>
        <div class="form-group">
          <label>Typ</label>
          <div class="chips" id="goal-type-chips">
            <button type="button" class="chip active" data-type="oneoff">ğŸ’° Jednorazowy</button>
            <button type="button" class="chip" data-type="recurring">ğŸ”„ StaÅ‚y wydatek</button>
          </div>
        </div>
        <div class="form-group" id="goal-amount-group">
          <label>Docelowa kwota (zÅ‚)</label>
          <input type="number" id="goal-target" placeholder="10000">
        </div>
        <div class="form-group" id="goal-saved-group">
          <label>JuÅ¼ zebrano (zÅ‚)</label>
          <input type="number" id="goal-saved" placeholder="0" value="0">
        </div>
        <!-- Dla jednorazowych: termin -->
        <div class="form-group" id="goal-deadline-group">
          <label>Termin</label>
          <input type="month" id="goal-deadline" value="2025-08">
        </div>
        <!-- Dla staÅ‚ych: zakres dat -->
        <div class="form-group date-range-group" id="goal-daterange-group" style="display: none;">
          <label>Okres trwania</label>
          <div class="date-range">
            <div class="date-field">
              <span>Od:</span>
              <input type="month" id="goal-start-date">
            </div>
            <div class="date-field">
              <span>Do:</span>
              <input type="month" id="goal-end-date">
            </div>
          </div>
          <div class="date-hint">np. leasing: sty 2024 - lip 2028</div>
        </div>
        <div class="form-group" id="goal-monthly-group" style="display: none;">
          <label>Kwota miesiÄ™czna (zÅ‚)</label>
          <input type="number" id="goal-monthly" placeholder="500">
        </div>
        <div class="form-group">
          <label>Ikona</label>
          <div class="chips">
            <button type="button" class="chip">ğŸ–ï¸</button>
            <button type="button" class="chip active">ğŸ“</button>
            <button type="button" class="chip">ğŸ </button>
            <button type="button" class="chip">ğŸš—</button>
            <button type="button" class="chip">ğŸ¦</button>
            <button type="button" class="chip">ğŸ’</button>
          </div>
        </div>
        <div class="calculated-info">
          <span>ğŸ’¡ Potrzeba:</span>
          <span class="calculated-value">1 250 zÅ‚/mies.</span>
        </div>
        <button type="submit" class="btn-primary sticky">ğŸ’¾ Zapisz</button>
      </form>
    </div>
  </div>

  <!-- ========== Bottom Navigation ========== -->
  <nav class="bottom-nav" id="bottom-nav" aria-label="Nawigacja gÅ‚Ã³wna">
    <button type="button" class="nav-item active" onclick="showScreen('screen-dashboard')" aria-label="Strona gÅ‚Ã³wna">
      <span class="nav-icon" aria-hidden="true">ğŸ </span>
      <span>Start</span>
    </button>
    <button type="button" class="nav-item" onclick="showScreen('screen-income')" aria-label="Przychody">
      <span class="nav-icon" aria-hidden="true">ğŸ’°</span>
      <span>Przychody</span>
    </button>
    <button type="button" class="nav-item" onclick="showScreen('screen-goals')" aria-label="Cele">
      <span class="nav-icon" aria-hidden="true">ğŸ¯</span>
      <span>Cele</span>
    </button>
    <button type="button" class="nav-item" onclick="showScreen('screen-achievements')" aria-label="OsiÄ…gniÄ™cia">
      <span class="nav-icon" aria-hidden="true">ğŸ†</span>
      <span>Punkty</span>
    </button>
    <button type="button" class="nav-item" onclick="showScreen('screen-settings')" aria-label="Ustawienia">
      <span class="nav-icon" aria-hidden="true">âš™ï¸</span>
      <span>WiÄ™cej</span>
    </button>
  </nav>

  <!-- Load managers first -->
  <script src="js/data-manager.js"></script>
  <script src="js/event-bus.js"></script>
  <script src="js/gamification-manager.js"></script>
  <script src="js/engagement-manager.js"></script>
  <script src="js/alert-manager.js"></script>
  <script src="js/pin-manager.js"></script>
  <script src="js/recurring-manager.js"></script>
  <script src="js/ai-advisor.js"></script>
  <script src="js/family-unity.js"></script>
  <script src="js/family-balance.js"></script>
  <script src="js/ui-features.js"></script>
  <script src="js/app.js"></script>
  <script>
    // PIN - using PinManager
    var pinInput = '';
    var dots = document.querySelectorAll('.pin-dot');
    var container = document.getElementById('pin-container');

    // Check if PIN is enabled, if not - skip to dashboard
    (function checkPinRequired() {
      if (typeof PinManager !== 'undefined') {
        if (!PinManager.isEnabled()) {
          // No PIN set - go directly to dashboard
          document.getElementById('pin-screen').classList.remove('active');
          document.getElementById('screen-dashboard').classList.add('active');
          document.getElementById('bottom-nav').classList.add('visible');
        } else if (PinManager.isSessionActive()) {
          // Session still active - go directly to dashboard
          document.getElementById('pin-screen').classList.remove('active');
          document.getElementById('screen-dashboard').classList.add('active');
          document.getElementById('bottom-nav').classList.add('visible');
        }
      }
    })();

    function pinKey(k) {
      if (k === 'del') { pinInput = pinInput.slice(0, -1); }
      else if (pinInput.length < 4) { pinInput += k; }
      dots.forEach(function(d, i) {
        d.classList.toggle('filled', i < pinInput.length);
        d.classList.remove('error');
      });
      if (pinInput.length === 4) {
        setTimeout(function() {
          var isValid = false;
          if (typeof PinManager !== 'undefined' && PinManager.isEnabled()) {
            isValid = PinManager.verify(pinInput);
            if (isValid) {
              PinManager.startSession();
            }
          } else {
            // Fallback - default PIN
            isValid = (pinInput === '9890');
          }

          if (isValid) {
            document.getElementById('pin-screen').classList.remove('active');
            document.getElementById('screen-dashboard').classList.add('active');
            document.getElementById('bottom-nav').classList.add('visible');
          } else {
            container.classList.add('shake');
            dots.forEach(function(d) { d.classList.add('error'); });
            setTimeout(function() {
              container.classList.remove('shake');
              pinInput = '';
              dots.forEach(function(d) { d.classList.remove('filled', 'error'); });
            }, 400);
          }
        }, 150);
      }
    }

    // Navigation
    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(function(s) { s.classList.remove('active'); });
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('.nav-item').forEach(function(n, i) {
        var screens = ['screen-dashboard', 'screen-income', 'screen-goals', 'screen-achievements', 'screen-settings'];
        n.classList.toggle('active', screens[i] === id);
      });
      closeAllModals();
    }

    // Modals
    function openModal(id) {
      closeAllModals();
      document.getElementById(id).classList.add('active');
    }
    function closeModal(e) {
      if (e.target.classList.contains('modal')) { e.target.classList.remove('active'); }
    }
    function closeAllModals() {
      document.querySelectorAll('.modal').forEach(function(m) { m.classList.remove('active'); });
      // Reset edit state in app
      if (typeof app !== 'undefined' && app.resetEditState) {
        app.resetEditState();
      }
      // Reset modal titles
      var goalModal = document.getElementById('modal-goal');
      if (goalModal) goalModal.querySelector('.modal-header h2').textContent = 'ğŸ¯ Nowy cel';
      var incomeModal = document.getElementById('modal-income');
      if (incomeModal) incomeModal.querySelector('.modal-header h2').textContent = 'ğŸ’µ Dodaj przychÃ³d';
    }

    // Chips
    document.querySelectorAll('.chips').forEach(function(container) {
      container.addEventListener('click', function(e) {
        if (e.target.classList.contains('chip')) {
          container.querySelectorAll('.chip').forEach(function(c) { c.classList.remove('active'); });
          e.target.classList.add('active');
        }
      });
    });

    // Month
    var months = ['StyczeÅ„','Luty','Marzec','KwiecieÅ„','Maj','Czerwiec','Lipiec','SierpieÅ„','WrzesieÅ„','PaÅºdziernik','Listopad','GrudzieÅ„'];
    var now = new Date();
    document.getElementById('month-badge').textContent = months[now.getMonth()] + ' ' + now.getFullYear();

    // Service Worker Registration
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(function(reg) { console.log('SW registered'); })
        .catch(function(err) { console.log('SW error:', err); });
    }

    // Keyboard accessibility for role="button" elements
    document.addEventListener('keydown', function(e) {
      if (e.target.getAttribute('role') === 'button' && (e.key === 'Enter' || e.key === ' ')) {
        e.preventDefault();
        e.target.click();
      }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeAllModals();
      }
    });
  </script>

</body>
</html>
